define MAX_UNLOCK_LEVEL 4
quest shop_unlock_slots begin
    state start begin
        when 30376.use begin
            local unlock_level = pc.get_special_flag("shop_unlock_slot")
            if unlock_level >= MAX_UNLOCK_LEVEL then
                syschat(translate.shop_unlock_slot.max_progress)
                return
            end

            if item.remove(1) then
                pc.set_special_flag("shop_unlock_slot", unlock_level+1)
                syschat(translate.shop_unlock_slot.success)
            end
        end
    end
end